{"ast":null,"code":"export default {\n  actions: {\n    async logIn(context, {\n      username,\n      password,\n      isSavedSession\n    }) {\n      const res = await fetch(context.state.baseURL + \"users/auth/token/login/\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          username,\n          password\n        })\n      });\n      const token = await res.json();\n      context.commit(\"setToken\", token.auth_token);\n      await context.dispatch('getUser');\n\n      if (isSavedSession) {\n        context.commit(\"saveTokenToLocalStorage\");\n        context.commit(\"saveUserToLocalStorage\");\n      }\n\n      if (context.$store.state.auth.isAuth) {\n        context.$router.push(\"/\");\n      }\n    },\n\n    async getUser(context) {\n      const res = await fetch(context.state.baseURL + \"users/employee/current/\", {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": \"Token \" + context.state.token\n        }\n      });\n      const user = await res.json();\n      context.commit(\"updateUser\", user);\n    }\n\n  },\n  mutations: {\n    setToken(state, token) {\n      state.token = token;\n      state.isAuth = true;\n    },\n\n    saveTokenToLocalStorage(state) {\n      localStorage.setItem(\"token\", state.token);\n    },\n\n    saveUserToLocalStorage(state) {\n      localStorage.setItem(\"user\", JSON.stringify(state.user));\n    },\n\n    updateUser(state, user) {\n      state.user = user;\n    },\n\n    loadDataFromLocalStorage(state) {\n      state.token = localStorage.getItem(\"token\");\n      state.user = JSON.parse(localStorage.getItem(\"user\"));\n    },\n\n    logOut(state) {\n      state.token = \"\";\n      state.user = {};\n      localStorage.removeItem('token');\n      localStorage.removeItem(\"user\");\n    }\n\n  },\n  state: {\n    token: \"\",\n    user: {},\n    baseURL: \"http://sbermeeting.tk/api/v2/\",\n    isAuth: false\n  },\n  getters: {}\n};","map":{"version":3,"names":["actions","logIn","context","username","password","isSavedSession","res","fetch","state","baseURL","method","headers","body","JSON","stringify","token","json","commit","auth_token","dispatch","$store","auth","isAuth","$router","push","getUser","user","mutations","setToken","saveTokenToLocalStorage","localStorage","setItem","saveUserToLocalStorage","updateUser","loadDataFromLocalStorage","getItem","parse","logOut","removeItem","getters"],"sources":["/Users/root1/Developments/SberMeetingsWeb/WebApplication/vue-project/src/store/modules/auth.js"],"sourcesContent":["export default {\n    actions: {\n        async logIn(context, {username, password, isSavedSession}) {\n            const res = await fetch(\n                context.state.baseURL + \"users/auth/token/login/\",\n                {\n                  method: \"POST\",\n                  headers: {\n                    \"Content-Type\": \"application/json\",\n                  },\n                  body: JSON.stringify({\n                    username,\n                    password\n                  }),\n                }\n              );\n        \n              const token = await res.json();\n              context.commit(\"setToken\", token.auth_token);\n              \n              await context.dispatch('getUser');\n\n              if (isSavedSession) {\n                context.commit(\"saveTokenToLocalStorage\");\n                context.commit(\"saveUserToLocalStorage\");\n              }\n\n              if (context.$store.state.auth.isAuth) {\n                context.$router.push(\"/\");\n              }\n        },\n\n        async getUser(context) {\n            const res = await fetch(context.state.baseURL + \"users/employee/current/\", {\n                method: \"GET\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": \"Token \" + context.state.token\n                }\n              });\n        \n              const user = await res.json();\n              context.commit(\"updateUser\", user);\n        }\n    },\n    \n    mutations: {\n        setToken(state, token) {\n            state.token = token;\n            state.isAuth = true;\n        },\n\n        saveTokenToLocalStorage(state) {\n            localStorage.setItem(\"token\", state.token);\n        },\n\n        saveUserToLocalStorage(state) {\n            localStorage.setItem(\"user\", JSON.stringify(state.user));\n        },\n\n        updateUser(state, user) {\n            state.user = user;\n        },\n\n        loadDataFromLocalStorage(state) {\n            state.token = localStorage.getItem(\"token\");\n            state.user = JSON.parse(localStorage.getItem(\"user\"));\n        },\n\n        logOut(state) {\n            state.token = \"\";\n            state.user = {};\n            localStorage.removeItem('token');\n            localStorage.removeItem(\"user\");\n        }\n    },\n    \n    state: {\n        token: \"\",\n        user: {},\n        baseURL: \"http://sbermeeting.tk/api/v2/\",\n        isAuth: false\n    },\n    \n    getters: {}\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}