{"ast":null,"code":"import api from '@/api';\nexport default {\n  actions: {\n    async logIn(context, {\n      username,\n      password,\n      isSavedSession\n    }) {\n      const token = await api.auth(username, password);\n\n      if (token === null) {\n        context.commit(\"setErrorMessage\", api.error);\n        api.error = '';\n        return false;\n      }\n\n      context.commit(\"setToken\", \"token.auth_token\");\n      let isAuth = true;\n      const user = await context.dispatch('getUser');\n\n      if (user === null) {\n        isAuth = false;\n      }\n\n      console.log(context.state.errorMessage);\n\n      if (isSavedSession) {\n        context.commit(\"saveSessionToLocalStorage\");\n      }\n\n      context.commit(\"saveSessionToSessionStorage\");\n      context.commit(\"setErrorMessage\", api.error);\n      return isAuth;\n    },\n\n    async getUser(context) {\n      const user = await api.currentUser(context.state.token);\n\n      if (user === null) {\n        context.commit(\"setErrorMessage\", api.error);\n        api.error = '';\n        return null;\n      }\n\n      context.commit(\"updateUser\", user);\n      return user;\n    }\n\n  },\n  mutations: {\n    setToken(state, token) {\n      state.token = token;\n    },\n\n    saveSessionToLocalStorage(state) {\n      localStorage.setItem(\"token\", state.token);\n      localStorage.setItem(\"user\", JSON.stringify(state.user));\n    },\n\n    saveSessionToSessionStorage(state) {\n      sessionStorage.setItem(\"token\", state.token);\n      sessionStorage.setItem(\"user\", JSON.stringify(state.user));\n    },\n\n    updateUser(state, user) {\n      state.user = user;\n    },\n\n    loadDataFromLocalStorage(state) {\n      state.token = localStorage.getItem(\"token\");\n      state.user = JSON.parse(localStorage.getItem(\"user\"));\n    },\n\n    loadDataFromSessionStorage(state) {\n      state.token = sessionStorage.getItem(\"token\");\n      state.user = JSON.parse(sessionStorage.getItem(\"user\"));\n    },\n\n    logOut(state) {\n      state.token = \"\";\n      state.user = {};\n      localStorage.removeItem('token');\n      localStorage.removeItem(\"user\");\n    },\n\n    setErrorMessage(state, error) {\n      state.errorMessage = error;\n    }\n\n  },\n  state: {\n    token: null,\n    user: {},\n    errorMessage: ''\n  },\n  getters: {}\n};","map":{"version":3,"names":["api","actions","logIn","context","username","password","isSavedSession","token","auth","commit","error","isAuth","user","dispatch","console","log","state","errorMessage","getUser","currentUser","mutations","setToken","saveSessionToLocalStorage","localStorage","setItem","JSON","stringify","saveSessionToSessionStorage","sessionStorage","updateUser","loadDataFromLocalStorage","getItem","parse","loadDataFromSessionStorage","logOut","removeItem","setErrorMessage","getters"],"sources":["/Users/root1/Developments/SberMeetingsWeb/WebApplication/vue-project/src/store/modules/auth.js"],"sourcesContent":["import api from '@/api'\n\nexport default {\n    actions: {\n        async logIn(context, { username, password, isSavedSession }) {\n            \n            const token = await api.auth(username, password);\n            if (token === null) {\n                context.commit(\"setErrorMessage\", api.error);\n                api.error = '';\n                return false;\n            }\n\n            context.commit(\"setToken\", \"token.auth_token\");\n            \n            let isAuth = true;\n\n            const user = await context.dispatch('getUser');\n            if (user === null) {\n                isAuth = false;    \n            }\n            console.log(context.state.errorMessage);\n\n            if (isSavedSession) {\n                context.commit(\"saveSessionToLocalStorage\");\n            }\n\n            context.commit(\"saveSessionToSessionStorage\");\n            context.commit(\"setErrorMessage\", api.error);\n            return isAuth;\n            \n        },\n\n        async getUser(context) {\n            const user = await api.currentUser(context.state.token);\n            if (user === null) {\n                context.commit(\"setErrorMessage\", api.error);\n                api.error = '';\n                return null;\n            }\n\n            context.commit(\"updateUser\", user);\n            return user;\n        }\n    },\n\n    mutations: {\n        setToken(state, token) {\n            state.token = token;\n        },\n\n        saveSessionToLocalStorage(state) {\n            localStorage.setItem(\"token\", state.token);\n            localStorage.setItem(\"user\", JSON.stringify(state.user));\n        },\n\n        saveSessionToSessionStorage(state) {\n            sessionStorage.setItem(\"token\", state.token);\n            sessionStorage.setItem(\"user\", JSON.stringify(state.user));\n        },\n\n        updateUser(state, user) {\n            state.user = user;\n        },\n\n        loadDataFromLocalStorage(state) {\n            state.token = localStorage.getItem(\"token\");\n            state.user = JSON.parse(localStorage.getItem(\"user\"));\n        },\n\n        loadDataFromSessionStorage(state) {\n            state.token = sessionStorage.getItem(\"token\");\n            state.user = JSON.parse(sessionStorage.getItem(\"user\"));\n        },\n\n        logOut(state) {\n            state.token = \"\";\n            state.user = {};\n            localStorage.removeItem('token');\n            localStorage.removeItem(\"user\");\n        },\n\n        setErrorMessage(state, error) {\n            state.errorMessage = error; \n        }\n    },\n\n    state: {\n        token: null,\n        user: {},\n        errorMessage: ''\n    },\n\n    getters: {}\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}