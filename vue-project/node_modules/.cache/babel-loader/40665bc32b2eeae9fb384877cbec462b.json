{"ast":null,"code":"import api from '@/api';\nexport default {\n  actions: {\n    async logIn(context, {\n      username,\n      password,\n      isSavedSession\n    }) {\n      // const res = await fetch(\n      //     context.state.baseURL + \"users/auth/token/login/\",\n      //     {\n      //       method: \"POST\",\n      //       headers: {\n      //         \"Content-Type\": \"application/json\",\n      //       },\n      //       body: JSON.stringify({\n      //         username,\n      //         password\n      //       }),\n      //     }\n      //   );\n      const token = await api.auth(username, password).auth_token;\n      context.commit(\"setToken\", token.auth_token);\n      await context.dispatch('getUser');\n\n      if (isSavedSession) {\n        context.commit(\"saveSessionToLocalStorage\");\n      }\n\n      context.commit(\"saveSessionToSessionStorage\");\n      const test = await api.auth(username, password);\n      console.log(test);\n      return true;\n    },\n\n    async getUser(context) {\n      const res = await fetch(context.state.baseURL + \"users/employee/current/\", {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": \"Token \" + context.state.token\n        }\n      });\n      const user = await res.json();\n      context.commit(\"updateUser\", user);\n    }\n\n  },\n  mutations: {\n    setToken(state, token) {\n      state.token = token;\n    },\n\n    saveSessionToLocalStorage(state) {\n      localStorage.setItem(\"token\", state.token);\n      localStorage.setItem(\"user\", JSON.stringify(state.user));\n    },\n\n    saveSessionToSessionStorage(state) {\n      sessionStorage.setItem(\"token\", state.token);\n      sessionStorage.setItem(\"user\", JSON.stringify(state.user));\n    },\n\n    updateUser(state, user) {\n      state.user = user;\n    },\n\n    loadDataFromLocalStorage(state) {\n      state.token = localStorage.getItem(\"token\");\n      state.user = JSON.parse(localStorage.getItem(\"user\"));\n    },\n\n    loadDataFromSessionStorage(state) {\n      state.token = sessionStorage.getItem(\"token\");\n      state.user = JSON.parse(sessionStorage.getItem(\"user\"));\n    },\n\n    logOut(state) {\n      state.token = \"\";\n      state.user = {};\n      localStorage.removeItem('token');\n      localStorage.removeItem(\"user\");\n    }\n\n  },\n  state: {\n    token: null,\n    user: {},\n    baseURL: \"http://sbermeeting.tk/api/v2/\"\n  },\n  getters: {}\n};","map":{"version":3,"names":["api","actions","logIn","context","username","password","isSavedSession","token","auth","auth_token","commit","dispatch","test","console","log","getUser","res","fetch","state","baseURL","method","headers","user","json","mutations","setToken","saveSessionToLocalStorage","localStorage","setItem","JSON","stringify","saveSessionToSessionStorage","sessionStorage","updateUser","loadDataFromLocalStorage","getItem","parse","loadDataFromSessionStorage","logOut","removeItem","getters"],"sources":["/Users/root1/Developments/SberMeetingsWeb/WebApplication/vue-project/src/store/modules/auth.js"],"sourcesContent":["import api from '@/api'\n\nexport default {\n    actions: {\n        async logIn(context, {username, password, isSavedSession}) {\n            // const res = await fetch(\n            //     context.state.baseURL + \"users/auth/token/login/\",\n            //     {\n            //       method: \"POST\",\n            //       headers: {\n            //         \"Content-Type\": \"application/json\",\n            //       },\n            //       body: JSON.stringify({\n            //         username,\n            //         password\n            //       }),\n            //     }\n            //   );\n            \n              const token = await api.auth(username, password).auth_token;\n              context.commit(\"setToken\", token.auth_token);\n              \n              await context.dispatch('getUser');\n\n              if (isSavedSession) {\n                context.commit(\"saveSessionToLocalStorage\");\n              }\n\n              context.commit(\"saveSessionToSessionStorage\");\n\n              const test = await api.auth(username, password);\n              console.log(test);\n\n              return true;\n        },\n\n        async getUser(context) {\n            const res = await fetch(context.state.baseURL + \"users/employee/current/\", {\n                method: \"GET\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": \"Token \" + context.state.token\n                }\n              });\n        \n              const user = await res.json();\n              context.commit(\"updateUser\", user);\n        }\n    },\n    \n    mutations: {\n        setToken(state, token) {\n            state.token = token;\n        },\n\n        saveSessionToLocalStorage(state) {\n            localStorage.setItem(\"token\", state.token);\n            localStorage.setItem(\"user\", JSON.stringify(state.user));\n        },\n\n        saveSessionToSessionStorage(state) {\n            sessionStorage.setItem(\"token\", state.token);\n            sessionStorage.setItem(\"user\", JSON.stringify(state.user));\n        },\n\n        updateUser(state, user) {\n            state.user = user;\n        },\n\n        loadDataFromLocalStorage(state) {\n            state.token = localStorage.getItem(\"token\");\n            state.user = JSON.parse(localStorage.getItem(\"user\"));\n        },\n\n        loadDataFromSessionStorage(state) {\n            state.token = sessionStorage.getItem(\"token\");\n            state.user = JSON.parse(sessionStorage.getItem(\"user\"));\n        },\n\n        logOut(state) {\n            state.token = \"\";\n            state.user = {};\n            localStorage.removeItem('token');\n            localStorage.removeItem(\"user\");\n        }\n    },\n    \n    state: {\n        token: null,\n        user: {},\n        baseURL: \"http://sbermeeting.tk/api/v2/\",\n    },\n    \n    getters: {}\n}"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,OAAhB;AAEA,eAAe;EACXC,OAAO,EAAE;IACL,MAAMC,KAAN,CAAYC,OAAZ,EAAqB;MAACC,QAAD;MAAWC,QAAX;MAAqBC;IAArB,CAArB,EAA2D;MACvD;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MAEE,MAAMC,KAAK,GAAG,MAAMP,GAAG,CAACQ,IAAJ,CAASJ,QAAT,EAAmBC,QAAnB,EAA6BI,UAAjD;MACAN,OAAO,CAACO,MAAR,CAAe,UAAf,EAA2BH,KAAK,CAACE,UAAjC;MAEA,MAAMN,OAAO,CAACQ,QAAR,CAAiB,SAAjB,CAAN;;MAEA,IAAIL,cAAJ,EAAoB;QAClBH,OAAO,CAACO,MAAR,CAAe,2BAAf;MACD;;MAEDP,OAAO,CAACO,MAAR,CAAe,6BAAf;MAEA,MAAME,IAAI,GAAG,MAAMZ,GAAG,CAACQ,IAAJ,CAASJ,QAAT,EAAmBC,QAAnB,CAAnB;MACAQ,OAAO,CAACC,GAAR,CAAYF,IAAZ;MAEA,OAAO,IAAP;IACL,CA/BI;;IAiCL,MAAMG,OAAN,CAAcZ,OAAd,EAAuB;MACnB,MAAMa,GAAG,GAAG,MAAMC,KAAK,CAACd,OAAO,CAACe,KAAR,CAAcC,OAAd,GAAwB,yBAAzB,EAAoD;QACvEC,MAAM,EAAE,KAD+D;QAEvEC,OAAO,EAAE;UACL,gBAAgB,kBADX;UAEL,iBAAiB,WAAWlB,OAAO,CAACe,KAAR,CAAcX;QAFrC;MAF8D,CAApD,CAAvB;MAQE,MAAMe,IAAI,GAAG,MAAMN,GAAG,CAACO,IAAJ,EAAnB;MACApB,OAAO,CAACO,MAAR,CAAe,YAAf,EAA6BY,IAA7B;IACL;;EA5CI,CADE;EAgDXE,SAAS,EAAE;IACPC,QAAQ,CAACP,KAAD,EAAQX,KAAR,EAAe;MACnBW,KAAK,CAACX,KAAN,GAAcA,KAAd;IACH,CAHM;;IAKPmB,yBAAyB,CAACR,KAAD,EAAQ;MAC7BS,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BV,KAAK,CAACX,KAApC;MACAoB,YAAY,CAACC,OAAb,CAAqB,MAArB,EAA6BC,IAAI,CAACC,SAAL,CAAeZ,KAAK,CAACI,IAArB,CAA7B;IACH,CARM;;IAUPS,2BAA2B,CAACb,KAAD,EAAQ;MAC/Bc,cAAc,CAACJ,OAAf,CAAuB,OAAvB,EAAgCV,KAAK,CAACX,KAAtC;MACAyB,cAAc,CAACJ,OAAf,CAAuB,MAAvB,EAA+BC,IAAI,CAACC,SAAL,CAAeZ,KAAK,CAACI,IAArB,CAA/B;IACH,CAbM;;IAePW,UAAU,CAACf,KAAD,EAAQI,IAAR,EAAc;MACpBJ,KAAK,CAACI,IAAN,GAAaA,IAAb;IACH,CAjBM;;IAmBPY,wBAAwB,CAAChB,KAAD,EAAQ;MAC5BA,KAAK,CAACX,KAAN,GAAcoB,YAAY,CAACQ,OAAb,CAAqB,OAArB,CAAd;MACAjB,KAAK,CAACI,IAAN,GAAaO,IAAI,CAACO,KAAL,CAAWT,YAAY,CAACQ,OAAb,CAAqB,MAArB,CAAX,CAAb;IACH,CAtBM;;IAwBPE,0BAA0B,CAACnB,KAAD,EAAQ;MAC9BA,KAAK,CAACX,KAAN,GAAcyB,cAAc,CAACG,OAAf,CAAuB,OAAvB,CAAd;MACAjB,KAAK,CAACI,IAAN,GAAaO,IAAI,CAACO,KAAL,CAAWJ,cAAc,CAACG,OAAf,CAAuB,MAAvB,CAAX,CAAb;IACH,CA3BM;;IA6BPG,MAAM,CAACpB,KAAD,EAAQ;MACVA,KAAK,CAACX,KAAN,GAAc,EAAd;MACAW,KAAK,CAACI,IAAN,GAAa,EAAb;MACAK,YAAY,CAACY,UAAb,CAAwB,OAAxB;MACAZ,YAAY,CAACY,UAAb,CAAwB,MAAxB;IACH;;EAlCM,CAhDA;EAqFXrB,KAAK,EAAE;IACHX,KAAK,EAAE,IADJ;IAEHe,IAAI,EAAE,EAFH;IAGHH,OAAO,EAAE;EAHN,CArFI;EA2FXqB,OAAO,EAAE;AA3FE,CAAf"},"metadata":{},"sourceType":"module"}